import React, { useEffect } from "react";
import { View, Text, ActivityIndicator } from "react-native";
import { useRouter } from "expo-router";
import { useAuth } from "@/utils/auth/useAuth";
import { useTheme } from "@/contexts/ThemeContext";
import { StatusBar } from "expo-status-bar";
import { useSafeAreaInsets } from "react-native-safe-area-context";

export default function Index() {
  const { isAuthenticated, isReady } = useAuth();
  const { colors, statusBarStyle } = useTheme();
  const insets = useSafeAreaInsets();
  const router = useRouter();

  useEffect(() => {
    if (isReady) {
      if (isAuthenticated) {
        // User is authenticated, redirect to main tabs
        router.replace("/(tabs)/home");
      } else {
        // User is not authenticated, redirect to auth
        router.replace("/auth");
      }
    }
  }, [isReady, isAuthenticated, router]);

  // Show loading screen while checking authentication
  if (!isReady) {
    return (
      <View
        style={{
          flex: 1,
          backgroundColor: colors.background,
          justifyContent: "center",
          alignItems: "center",
          paddingTop: insets.top,
        }}
      >
        <StatusBar style={statusBarStyle} />

        {/* CampusBite Logo/Branding */}
        <View
          style={{
            backgroundColor: colors.primary,
            borderRadius: 40,
            width: 80,
            height: 80,
            justifyContent: "center",
            alignItems: "center",
            marginBottom: 24,
          }}
        >
          <Text
            style={{
              fontSize: 32,
              fontWeight: "bold",
              color: "white",
            }}
          >
            üçï
          </Text>
        </View>

        <Text
          style={{
            fontFamily: "Inter_600SemiBold",
            fontSize: 28,
            color: colors.text,
            marginBottom: 8,
          }}
        >
          CampusBite
        </Text>

        <Text
          style={{
            fontFamily: "Inter_400Regular",
            fontSize: 16,
            color: colors.textSecondary,
            marginBottom: 32,
            textAlign: "center",
          }}
        >
          Pre-order your favorite campus meals
        </Text>

        <ActivityIndicator size="large" color={colors.primary} />
      </View>
    );
  }

  // This should not be reached due to the useEffect above, but just in case
  return null;
}
